<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bbuy">
	
	<insert id="insertBBuy" parameterType="BBuyVo">
	 <![CDATA[
			insert into bbuy
			values( seq_bbuy_no.nextval,
			        #{user_no},
			        #{booking_no},
			        #{profile_no},
			        #{b_buy_paytype},
			        #{price},
			        #{b_buy_state},
			        #{b_buy_player_state},
			        null,
			        null,
			        null,
			        null,
			        sysdate)	 	
	 
	 ]]>
	</insert>
	
	<insert id="insertBBuy2" parameterType="BBuyVo">
	<![CDATA[
		insert into bbuy
		values( seq_bbuy_no.nextval,
		        #{user_no},
		        null,
		        #{profile_no},
		        null,
		        null,
		        null,
		        #{b_buy_player_state},
		        #{b_buy_address},
		        #{b_buy_event},
		        #{b_buy_time},
		        #{b_buy_day},
		        sysdate
		        )		
	
	]]>
	</insert>
	
	<select id="selectListBBuy" resultType="BBuyVo">
		<![CDATA[
			select b.b_buy_no,
			       b.profile_no,
			       p.nickname,
			       p.career,
			       b.b_buy_price,
			       b.b_buy_player_state,
			       b.b_buy_address,
       			   b.b_buy_event,
       			   b.b_buy_time,
       			   b.b_buy_day,
			       k.booking_no ,
			       k.booking_date,
			       k.booking_start,
			       k.booking_end,
			       k.gym_name,
			       k.gym_address,
			       k.gym_event,
			       k.gym_img_savename
			from bbuy b , (select p.profile_no,
			                      p.user_no,
			                      u.user_no,
			                      p.career,
			                      u.nickname
			               from profile p,users u
			               where p.user_no = u.user_no)p,(select b.booking_no,
			                                                     b.booking_start,
			                                                     b.booking_end,
			                                                     b.booking_date,
			                                                     g.gym_name,
			                                                     g.gym_address,
			                                                     g.gym_event,
			                                                     i.gym_img_savename,
			                                                     i.gym_img_type
			                                              from booking b , gym g ,gymImg i
			                                              where b.gym_no = g.gym_no
			                                              and g.gym_no = i.gym_no
			                                              and i.gym_img_type = 'main')k
			where b.profile_no = p.profile_no(+)
			and b.booking_no = k.booking_no(+)
			and b.b_buy_player_state = '시합등록자'
			order by b_buy_no desc
		
		]]>	

	</select>
</mapper>