<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="alarm">
	<select id="bbuyuserNo" parameterType="int" resultType="AlarmVo">
		<![CDATA[
		
				select user_no
				from bbuy
				where b_buy_no = #{bbuyno}
		]]>
	</select>

	<insert id="insertMatchAlarm" parameterType="AlarmVo">		
		<![CDATA[
			INSERT INTO alarm VALUES(seq_alarm_no.nextval, 
								0, 
								#{user_no}, 
								#{alarm_content},
								sysdate, 
								#{sell_no},
								#{alarm_title},
								2
								)		
		]]>
	</insert>

	<insert id="insertResistrar" parameterType="AlarmVo">
		<![CDATA[
			INSERT INTO alarm VALUES(seq_alarm_no.nextval, 
								0, 
								#{user_no}, 
								#{alarm_content},
								sysdate, 
								#{sell_no},
								#{alarm_title},
								2
								)
		]]>
	</insert>

	<insert id="inserAlarmtoseller" parameterType="AlarmVo">
		<![CDATA[
		INSERT INTO alarm VALUES(seq_alarm_no.nextval, 
								0, 
								#{user_no}, 
								#{alarm_content},
								sysdate, 
								#{sell_no},
								#{alarm_title},
								2
								)
								
		
		
		]]>
	</insert>

	<select id="selectSellno" parameterType="int" resultType="AlarmVo">
	<![CDATA[
		SELECT s.user_no,
			   s.sell_no,
			   g.gym_name as  alarm_title
		FROM BOOKING B  , gym g , seller s
		WHERE B.BOOKING_NO = #{booking_no}
		and b.gym_no = g.gym_no
		and g.sell_no =  s.sell_no	
	]]>
	</select>

	<select id="selectAlarm" parameterType="int" resultType="AlarmVo">
		<![CDATA[
			SELECT  alarm_no,
			        from_user_no,
			        to_user_no,
			        alarm_content,
			        alarm_date,
			        sell_no,
			        alarm_title,
			        buy_type
			FROM    alarm
			WHERE   to_user_no = #{user_no}
			order by alarm_date desc
		]]>
	</select>

	<!-- 결제완료 -->
	<select id="prodSelectList" parameterType="int" resultType="AlarmVo">
		<![CDATA[
			SELECT  bp.prod_no,
			        p.prod_name,
			        p.sell_no,
			        b.user_no,
			        bp.buy_del_state
			FROM    buyproduct bp, product p, buy b
			WHERE   bp.prod_no = p.prod_no
			        and b.buy_no = bp.buy_no
			        and b.buy_no = #{buy_no}
		]]>
	</select>

	<!-- 배송준비 중 -->
	<select id="prodSelect" parameterType="int" resultType="AlarmVo">
		<![CDATA[
			SELECT  bp.prod_no,
			        p.prod_name,
                    bp.buyprod_no,
			        p.sell_no,
			        b.user_no,
			        bp.buy_del_state
			FROM    buyproduct bp, product p, buy b
			WHERE   bp.prod_no = p.prod_no
			        and b.buy_no = bp.buy_no
                    and bp.buyprod_no = #{buyprod_no}
		]]>
	</select>

	<!-- 상품인서트 -->
	<insert id="insertProdAlarm" parameterType="AlarmVo">
		<![CDATA[
			INSERT INTO alarm VALUES(seq_alarm_no.nextval, 
									 0, 
									 #{user_no}, 
									 #{alarm_content}, 
									 sysdate, 
								 	 #{sell_no}, 
									 #{prod_name}, 
									 1)
		]]>
	</insert>

	<!-- 판매자 user_no찾기 -->
	<select id="sellUsernoSelect" parameterType="int" resultType="AlarmVo">
        <![CDATA[
            select user_no
            from seller
            where sell_no = #{sell_no}
        ]]>
	</select>
</mapper>